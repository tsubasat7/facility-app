<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é‹å‘½ã®å…­å±æ€§è¨ºæ–­ï¼ˆå†…éƒ¨ãƒ„ãƒ¼ãƒ«ï¼‰</title>
<style>
body{font-family:sans-serif;background:#fff;margin:0}
header{padding:16px;border-bottom:1px solid #eee}
.container{max-width:900px;margin:auto;padding:24px}
.card{border:1px solid #ddd;border-radius:16px;padding:16px;margin-bottom:16px}
button{padding:10px 16px;border-radius:20px;border:1px solid #aaa;cursor:pointer}
.run{background:#222;color:#fff;border:none}
small{color:#666}
input{padding:8px}
</style>
</head>
<body>

<header>
<h2>ğŸ”® é‹å‘½ã®å…­å±æ€§è¨ºæ–­</h2>
<small>å†…éƒ¨ç”¨</small>
</header>

<div class="container">

<div class="card">
<label>åå‰</label><br>
<input id="name" style="width:100%"><br><br>

<label>ç”Ÿå¹´æœˆæ—¥</label><br>
<input id="birth" type="date" style="width:100%"><br><br>

<button class="run" onclick="analyze()">è¨ºæ–­ã™ã‚‹</button>
</div>

<div id="result"></div>

</div>

<script>
// å‘½æ•°è¨ˆç®—ï¼ˆ1ã€œ60ï¼‰
function calcMeisuu(date){
  let sum = date.replace(/-/g,"")
    .split("")
    .map(Number)
    .reduce((a,b)=>a+b,0);

  while(sum > 60){
    sum = sum.toString().split("")
      .reduce((a,b)=>a+Number(b),0);
  }
  return sum === 0 ? 60 : sum;
}

// JSONå®‰å…¨èª­ã¿è¾¼ã¿
async function safeFetch(path){
  const r = await fetch(path);
  if(!r.ok){
    throw new Error(path + " ãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“");
  }
  return r.json();
}

// ãƒ¡ã‚¤ãƒ³è¨ºæ–­
async function analyze(){
  const name  = document.getElementById("name").value || "æœªå…¥åŠ›";
  const birth = document.getElementById("birth").value;

  if(!birth){
    alert("ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  try{
    const meisuu = calcMeisuu(birth);
    const key = String(meisuu); // â˜…é‡è¦ï¼šæ–‡å­—åˆ—ã‚­ãƒ¼åŒ–

    const traits = await safeFetch("data/flattype_traits.json");
    const story  = await safeFetch("data/story.json");

    const t = traits[key];
    const s = story[key];

    if(!t || !s){
      throw new Error("å‘½æ•° " + meisuu + " ã®ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ã¾ã›ã‚“");
    }

    document.getElementById("result").innerHTML = `
      <div class="card">
        <h3>${name} ã•ã‚“</h3>
        <p><b>å‘½æ•°ï¼š</b>${meisuu}</p>

        <h4>â–  æ€§æ ¼ãƒ»å‚¾å‘</h4>
        <p>${t.core || "æœªå®šç¾©"}</p>

        <h4>â–  éå»ãƒ»è‚²ã¡</h4>
        <p>${s.past || "æœªå®šç¾©"}</p>
      </div>
    `;
  }catch(e){
    document.getElementById("result").innerHTML = `
      <div class="card">
        <b>ã‚¨ãƒ©ãƒ¼</b><br>
        ${e.message}
      </div>
    `;
  }
}
</script>

</body>
</html>
