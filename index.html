<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é‹å‘½ã®å…­å±æ€§è¨ºæ–­ï¼ˆå†…éƒ¨ãƒ„ãƒ¼ãƒ«ï¼‰</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Arial;
  background:#fff;color:#222;margin:0
}
header{border-bottom:1px solid #eee;padding:16px 24px}
.container{max-width:960px;margin:auto;padding:24px}
button{cursor:pointer}
.mode-select button{
  margin-right:8px;padding:10px 16px;border-radius:20px;
  border:1px solid #ddd;background:#fff
}
.mode-select button.active{background:#222;color:#fff}
.card{border:1px solid #e5e5e5;border-radius:18px;padding:22px;margin-bottom:20px}
input,select{width:100%;padding:8px;margin-top:4px}
.add{margin-top:12px;background:#f5f5f5;border:none;padding:8px 14px}
.run{margin-top:16px;background:#222;color:#fff;border:none;
  padding:12px 20px;border-radius:24px}
small{color:#666}
</style>
</head>

<body>
<header>
<h1>ğŸ”® é‹å‘½ã®å…­å±æ€§è¨ºæ–­ï¼ˆå†…éƒ¨ç”¨ï¼‰</h1>
<small>â€»å®¢æç¤ºã¯çµæœã®ã¿</small>
</header>

<div class="container">

<section class="mode-select">
<button onclick="setMode('single')" class="active">å€‹äºº</button>
<button onclick="setMode('pair')">ç›¸æ€§</button>
<button onclick="setMode('group')">ã‚°ãƒ«ãƒ¼ãƒ—</button>
</section>

<section class="card">
<h2>è¨ºæ–­å¯¾è±¡</h2>
<div id="persons"></div>
<button class="add" onclick="addPerson()">ï¼‹ äººã‚’è¿½åŠ </button>
<button class="run" onclick="analyze()">è¨ºæ–­ã™ã‚‹</button>
</section>

<section id="result"></section>
</div>

<script>
let mode="single";

function setMode(m){
  mode=m;
  document.querySelectorAll(".mode-select button")
    .forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
  resetPersons();
}

function resetPersons(){
  document.getElementById("persons").innerHTML="";
  let n = mode==="single"?1:mode==="pair"?2:3;
  for(let i=0;i<n;i++) addPerson();
}

function addPerson(){
  const wrap=document.createElement("div");
  wrap.className="card";
  wrap.innerHTML=`
    <label>åå‰</label>
    <input class="name">
    <label>ç”Ÿå¹´æœˆæ—¥</label>
    <input type="date" class="birth">
    <label>æ‰‹ç›¸</label>
    <select class="palm">
      <option value="æ™©æˆå‹">æ™©æˆå‹</option>
      <option value="æ”¯æ´å‹">æ”¯æ´å‹</option>
      <option value="è‡ªç”±å‹">è‡ªç”±å‹</option>
      <option value="çµ±ç‡å‹">çµ±ç‡å‹</option>
    </select>
  `;
  document.getElementById("persons").appendChild(wrap);
}

/* å‘½æ•°è‡ªå‹•è¨ˆç®— */
function calcMeisuu(date){
  const nums=date.replace(/-/g,"").split("").map(Number);
  let sum=nums.reduce((a,b)=>a+b,0);
  while(sum>60){
    sum = sum.toString().split("").reduce((a,b)=>a+Number(b),0);
  }
  return sum===0?60:sum;
}

async function j(p){return fetch(p).then(r=>r.json())}

async function analyze(){
  const traits=await j("data/flattype_traits.json");
  const story=await j("data/story.json");
  const num=await j("data/numerology.json");
  const palm=await j("data/palmistry.json");
  const nameJ=await j("data/name_judge.json");

  let html="";
  document.querySelectorAll("#persons .card").forEach((c,i)=>{
    const name=c.querySelector(".name").value||`äººç‰©${i+1}`;
    const birth=c.querySelector(".birth").value;
    const palmType=c.querySelector(".palm").value;
    const meisuu=calcMeisuu(birth);

    const t=traits[meisuu];
    const s=story[meisuu];
    const n=num[meisuu];
    const p=palm[palmType];

    html+=`
    <div class="card">
      <h2>${name}</h2>
      <small>å‘½æ•° ${meisuu}ï½œ${n.zodiac}ï¼ˆ${n.metal}ï¼‰</small>
      <h3>æ€§æ ¼</h3><p>${t.core}</p>
      <h3>éå»</h3><p>${s.past}</p>
      <h3>è¡Œå‹•ãƒ»æ‰‹ç›¸</h3><p>${t.action}<br>${p.trait}</p>
      <h3>åŠ©è¨€</h3><p>${t.advice}</p>
    </div>`;
  });

  document.getElementById("result").innerHTML=html;
}

resetPersons();
</script>
</body>
</html>
