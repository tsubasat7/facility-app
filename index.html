<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é‹å‘½ã®å…­å±æ€§è¨ºæ–­ï¼ˆå†…éƒ¨ãƒ„ãƒ¼ãƒ«ï¼‰</title>

<style>
body{font-family:sans-serif;background:#fafafa;margin:0}
header{padding:16px;border-bottom:1px solid #ddd;background:#fff}
.container{max-width:1000px;margin:auto;padding:20px}
.card{background:#fff;border:1px solid #ddd;border-radius:12px;padding:16px;margin-bottom:20px}
h3{margin-top:0}
button{padding:10px 16px;border-radius:20px;border:1px solid #555;cursor:pointer;background:#fff}
button.run{background:#222;color:#fff;border:none}
button[disabled]{opacity:0.5;cursor:not-allowed;}
input,select{padding:8px;border:1px solid #ccc;border-radius:8px;width:100%}
.flex{display:flex;gap:20px}
.member-block{border:1px dashed #aaa;padding:16px;border-radius:12px;margin-bottom:16px;background:#fefefe}
</style>
</head>

<body>

<header>
<h2>ğŸ”® é‹å‘½ã®å…­å±æ€§è¨ºæ–­ï¼ˆå†…éƒ¨ãƒ„ãƒ¼ãƒ«ï¼‰</h2>
<small>å®Œå…¨ç‰ˆ / GitHub Pages å¯¾å¿œ</small>
</header>

<div class="container">

<!-- å€‹åˆ¥è¨ºæ–­ -->
<div class="card">
<h3>â–  å€‹åˆ¥è¨ºæ–­</h3>

<div class="flex">
<div style="flex:1">
<label>åå‰</label>
<input id="single_name">
</div>

<div style="flex:1">
<label>ç”Ÿå¹´æœˆæ—¥ï¼ˆè¨˜éŒ²ç”¨ï¼‰</label>
<input id="single_birth" type="date">
</div>

<div style="flex:1">
<label>å‘½æ•°ï¼ˆ1ã€œ60ï¼‰</label>
<input id="single_meisuu" type="number" min="1" max="60">
</div>
</div>

<br>
<button class="run" id="btn_single" disabled>èª­ã¿è¾¼ã¿ä¸­â€¦</button>
</div>

<div id="single_result"></div>


<!-- ç›¸æ€§è¨ºæ–­ -->
<div class="card">
<h3>â–  ç›¸æ€§è¨ºæ–­ï¼ˆ2äººï¼‰</h3>

<div class="flex">
<div style="flex:1">
<label>æœ¬äººã®å‘½æ•°</label>
<input id="pair_a" type="number" min="1" max="60">
</div>

<div style="flex:1">
<label>ç›¸æ‰‹ã®å‘½æ•°</label>
<input id="pair_b" type="number" min="1" max="60">
</div>
</div>

<br>
<button class="run" id="btn_pair" disabled>èª­ã¿è¾¼ã¿ä¸­â€¦</button>
</div>

<div id="pair_result"></div>


<!-- ã‚°ãƒ«ãƒ¼ãƒ—è¨ºæ–­ -->
<div class="card">
<h3>â–  ã‚°ãƒ«ãƒ¼ãƒ—è¨ºæ–­ï¼ˆè¤‡æ•°åï¼‰</h3>
<div id="group_area"></div>

<button id="btn_add" disabled>ï¼‹ äººã‚’è¿½åŠ </button>
<button class="run" id="btn_group" disabled>èª­ã¿è¾¼ã¿ä¸­â€¦</button>
</div>

<div id="group_result"></div>

</div> <!-- container -->


<script>
// -----------------------------------------------------
// JSONå¤‰æ•°
// -----------------------------------------------------
let TRAITS={}, STORY={}, META={}, COMPAT={};
let FLAT={}, PALM={}, ATTR={}, GROUP={}, MEISUU={}, NUMERO={}, PERSON={};

let loaded = false;

// -----------------------------------------------------
// GitHub Pages ã§ã‚‚ç¢ºå®Ÿã«å‹•ã JSON loader
// -----------------------------------------------------
async function loadJson(url){
  try{
    const res = await fetch(url, {cache:"no-store"});
    if(!res.ok) throw new Error(url + " HTTP " + res.status);
    return await res.json();
  }catch(e){
    console.error("JSONèª­ã¿è¾¼ã¿å¤±æ•—:", url, e);
    alert("JSONèª­ã¿è¾¼ã¿å¤±æ•—: " + url);
    throw e;
  }
}

// -----------------------------------------------------
// å…¨ JSON èª­ã¿è¾¼ã¿ï¼ˆç›´åˆ—ï¼‰
// -----------------------------------------------------
async function loadAll(){
  try{
    TRAITS  = await loadJson("data/traits.json");
    STORY   = await loadJson("data/story.json");
    META    = await loadJson("data/meta.json");
    COMPAT  = await loadJson("data/compatibility.json");

    FLAT    = await loadJson("data/flattype_traits.json");
    PALM    = await loadJson("data/palmistry.json");
    ATTR    = await loadJson("data/attributes.json");
    GROUP   = await loadJson("data/group.json");
    MEISUU  = await loadJson("data/meisuu.json");
    NUMERO  = await loadJson("data/numerology.json");
    PERSON  = await loadJson("data/person_template.json");

    loaded = true;

    // ãƒœã‚¿ãƒ³è§£æ”¾
    document.getElementById("btn_single").disabled = false;
    document.getElementById("btn_single").textContent = "è¨ºæ–­ã™ã‚‹";

    document.getElementById("btn_pair").disabled = false;
    document.getElementById("btn_pair").textContent = "ç›¸æ€§ã‚’è¦‹ã‚‹";

    document.getElementById("btn_group").disabled = false;
    document.getElementById("btn_group").textContent = "ã‚°ãƒ«ãƒ¼ãƒ—è¨ºæ–­å®Ÿè¡Œ";

    document.getElementById("btn_add").disabled = false;

    console.log("å…¨ JSON èª­ã¿è¾¼ã¿å®Œäº†");

  }catch(e){
    console.error("ãƒ­ãƒ¼ãƒ‰ä¸­æ–­", e);
  }
}

loadAll();

// -----------------------------------------------------
// â–  å€‹åˆ¥è¨ºæ–­
// -----------------------------------------------------
function analyzeSingle(){
  if(!loaded){ alert("ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­ã§ã™"); return; }

  const name   = document.getElementById("single_name").value || "æœªå…¥åŠ›";
  const birth  = document.getElementById("single_birth").value || "æœªå…¥åŠ›";
  const meisuu = Number(document.getElementById("single_meisuu").value);

  if(!meisuu || meisuu<1 || meisuu>60){
    alert("å‘½æ•°ã¯1ã€œ60ã§å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  // ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„å ´åˆã®å®‰å…¨ç­–
  const t = TRAITS[meisuu] || { core:"ãƒ‡ãƒ¼ã‚¿ãªã—" };
  const s = STORY[meisuu]  || { past:"ãƒ‡ãƒ¼ã‚¿ãªã—" };
  const m = META[meisuu]   || { zodiac:"ä¸æ˜", type:"ä¸æ˜" };

  document.getElementById("single_result").innerHTML = `
    <div class="card">
      <h3>${name} ã•ã‚“</h3>
      <p><b>å‘½æ•°ï¼š</b>${meisuu}</p>
      <p><b>å®ˆè­·æ˜Ÿåº§ï¼š</b>${m.zodiac}ï¼ˆ${m.type}ï¼‰</p>
      <p><b>ç”Ÿå¹´æœˆæ—¥ï¼š</b>${birth}</p>

      <h4>â–  æ€§æ ¼ãƒ»æ ¸</h4>
      <p>${t.core}</p>

      <h4>â–  éå»ã‚¹ãƒˆãƒ¼ãƒªãƒ¼</h4>
      <p>${s.past}</p>
    </div>
  `;
}


// -----------------------------------------------------
// â–  ç›¸æ€§è¨ºæ–­
// -----------------------------------------------------
function analyzePair(){
  if(!loaded){ alert("ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­ã§ã™"); return; }

  const a = Number(document.getElementById("pair_a").value);
  const b = Number(document.getElementById("pair_b").value);

  if(!a || !b){
    alert("å‘½æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  const key = `${a}-${b}`;
  const val = COMPAT[key] || "ç›¸æ€§ãƒ‡ãƒ¼ã‚¿ãªã—";

  document.getElementById("pair_result").innerHTML = `
    <div class="card">
      <h3>å‘½æ•° ${a} Ã— ${b}</h3>
      <p>${val}</p>
    </div>
  `;
}


// -----------------------------------------------------
// â–  ã‚°ãƒ«ãƒ¼ãƒ—è¿½åŠ 
// -----------------------------------------------------
function addMember(){
  const area = document.getElementById("group_area");
  const div = document.createElement("div");
  div.className = "member-block";
  div.innerHTML = `
    <label>åå‰</label>
    <input class="g_name">

    <label>ç”Ÿå¹´æœˆæ—¥ï¼ˆè¨˜éŒ²ç”¨ï¼‰</label>
    <input class="g_birth" type="date">

    <label>å‘½æ•°ï¼ˆ1ã€œ60ï¼‰</label>
    <input class="g_meisuu" type="number" min="1" max="60">
  `;
  area.appendChild(div);
}

// -----------------------------------------------------
// â–  ã‚°ãƒ«ãƒ¼ãƒ—è¨ºæ–­
// -----------------------------------------------------
function analyzeGroup(){
  if(!loaded){ alert("ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­ã§ã™"); return; }

  const blocks = document.querySelectorAll(".member-block");
  if(blocks.length===0){
    alert("äººæ•°ã‚’è¿½åŠ ã—ã¦ãã ã•ã„");
    return;
  }

  let members = [];

  blocks.forEach(b=>{
    const name = b.querySelector(".g_name").value || "æœªå…¥åŠ›";
    const birth = b.querySelector(".g_birth").value || "";
    const m = Number(b.querySelector(".g_meisuu").value);

    if(!m) return;

    members.push({
      name,
      birth,
      meisuu:m,
      trait:TRAITS[m] || {core:"ãƒ‡ãƒ¼ã‚¿ãªã—"},
      story:STORY[m] || {past:"ãƒ‡ãƒ¼ã‚¿ãªã—"},
      meta:META[m] || {zodiac:"ä¸æ˜", type:"ä¸æ˜"}
    });
  });

  if(members.length===0){
    alert("å‘½æ•°ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“");
    return;
  }

  // å€‹åˆ¥è¡¨ç¤º
  let html = `<div class="card"><h3>â–  å€‹åˆ¥è¨ºæ–­çµæœä¸€è¦§</h3>`;
  members.forEach(p=>{
    html += `
      <div class="member-block">
        <b>${p.name}</b><br>
        å‘½æ•°ï¼š${p.meisuu}<br>
        å®ˆè­·æ˜Ÿåº§ï¼š${p.meta.zodiac}ï¼ˆ${p.meta.type}ï¼‰<br>
        <b>æ€§æ ¼ï¼š</b>${p.trait.core}<br>
        <b>éå»ï¼š</b>${p.story.past}
      </div>
    `;
  });
  html += `</div>`;

  // ã‚°ãƒ«ãƒ¼ãƒ—ç›¸æ€§
  html += `<div class="card"><h3>â–  ã‚°ãƒ«ãƒ¼ãƒ—ç›¸æ€§</h3>`;
  for(let i=0;i<members.length;i++){
    for(let j=i+1;j<members.length;j++){
      const a = members[i].meisuu;
      const b = members[j].meisuu;
      const key = `${a}-${b}`;
      const val = COMPAT[key] || "ç›¸æ€§ãƒ‡ãƒ¼ã‚¿ãªã—";

      html += `
        <div class="member-block">
          <b>${members[i].name} Ã— ${members[j].name}</b><br>
          å‘½æ•° ${a} Ã— ${b}<br>
          <p>${val}</p>
        </div>
      `;
    }
  }
  html += `</div>`;

  document.getElementById("group_result").innerHTML = html;
}

</script>

</body>
</html>
