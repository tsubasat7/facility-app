<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é‹å‘½ã®å…­å±æ€§è¨ºæ–­ï¼ˆå†…éƒ¨ãƒ„ãƒ¼ãƒ«ï¼‰</title>

<style>
body{font-family:sans-serif;background:#fafafa;margin:0}
header{padding:16px;border-bottom:1px solid #ddd;background:#fff}
.container{max-width:1000px;margin:auto;padding:20px}
.card{background:#fff;border:1px solid #ddd;border-radius:12px;padding:16px;margin-bottom:20px}
h3{margin-top:0}
button{padding:10px 16px;border-radius:20px;border:1px solid #555;cursor:pointer;background:#fff}
button.run{background:#222;color:#fff;border:none}
button[disabled]{opacity:0.5;cursor:not-allowed}
input{padding:8px;border:1px solid #ccc;border-radius:8px;width:100%}
.flex{display:flex;gap:20px}
.member-block{border:1px dashed #aaa;padding:16px;border-radius:12px;margin-bottom:16px;background:#fefefe}
</style>
</head>

<body>
<header>
<h2>ğŸ”® é‹å‘½ã®å…­å±æ€§è¨ºæ–­ï¼ˆå†…éƒ¨ãƒ„ãƒ¼ãƒ«ï¼‰</h2>
<small>å®Œå…¨çµ±åˆç‰ˆ / GitHub Pages å¯¾å¿œ</small>
</header>

<div class="container">

<div class="card">
<h3>â–  å€‹åˆ¥è¨ºæ–­</h3>
<div class="flex">
<div>
<label>åå‰</label>
<input id="single_name">
</div>
<div>
<label>ç”Ÿå¹´æœˆæ—¥</label>
<input type="date" id="single_birth">
</div>
<div>
<label>å‘½æ•°ï¼ˆ1ã€œ60ï¼‰</label>
<input type="number" id="single_meisuu" min="1" max="60">
</div>
</div>
<br>
<button class="run" id="btn_single" disabled>èª­ã¿è¾¼ã¿ä¸­â€¦</button>
</div>
<div id="single_result"></div>

<div class="card">
<h3>â–  ç›¸æ€§è¨ºæ–­</h3>
<div class="flex">
<div>
<label>æœ¬äººå‘½æ•°</label>
<input type="number" id="pair_a" min="1" max="60">
</div>
<div>
<label>ç›¸æ‰‹å‘½æ•°</label>
<input type="number" id="pair_b" min="1" max="60">
</div>
</div>
<br>
<button class="run" id="btn_pair" disabled>èª­ã¿è¾¼ã¿ä¸­â€¦</button>
</div>
<div id="pair_result"></div>

</div>

<script>
/* ===============================
   ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ãƒ¼ã‚¿
================================ */
let TRAITS={}, STORY={}, META={}, ATTR={}, COMPAT={};

/* ===============================
   Safe JSON Loader
================================ */
async function safeLoad(url, fallback={}){
  try{
    const res = await fetch(url,{cache:"no-store"});
    if(!res.ok) throw new Error(res.status);
    return await res.json();
  }catch(e){
    console.warn("èª­ã¿è¾¼ã¿å¤±æ•—:",url,e);
    return fallback;
  }
}

/* ===============================
   å…¨ãƒ­ãƒ¼ãƒ‰
================================ */
async function init(){
  TRAITS = await safeLoad("data/traits.json");
  STORY  = await safeLoad("data/story.json");
  META   = await safeLoad("data/meta.json");
  ATTR   = await safeLoad("data/attributes.json");
  COMPAT = await safeLoad("data/compatibility.json");

  document.getElementById("btn_single").disabled=false;
  document.getElementById("btn_single").textContent="è¨ºæ–­ã™ã‚‹";

  document.getElementById("btn_pair").disabled=false;
  document.getElementById("btn_pair").textContent="ç›¸æ€§ã‚’è¦‹ã‚‹";

  console.log("åˆæœŸåŒ–å®Œäº†");
}
init();

/* ===============================
   å€‹åˆ¥è¨ºæ–­
================================ */
document.getElementById("btn_single").onclick=()=>{
  const name=document.getElementById("single_name").value||"æœªå…¥åŠ›";
  const birth=document.getElementById("single_birth").value||"";
  const m=Number(document.getElementById("single_meisuu").value);
  if(!m||m<1||m>60){alert("å‘½æ•°ã‚¨ãƒ©ãƒ¼");return;}

  const t=TRAITS[m]?.core||"æœªå®šç¾©";
  const s=STORY[m]?.past||"æœªå®šç¾©";
  const meta=META[m]||{zodiac:"ä¸æ˜",type:""};

  document.getElementById("single_result").innerHTML=`
  <div class="card">
    <h3>${name}</h3>
    <p>å‘½æ•°ï¼š${m}</p>
    <p>å®ˆè­·æ˜Ÿåº§ï¼š${meta.zodiac} ${meta.type}</p>
    <p>ç”Ÿå¹´æœˆæ—¥ï¼š${birth}</p>
    <h4>æ€§æ ¼</h4><p>${t}</p>
    <h4>éå»</h4><p>${s}</p>
  </div>`;
};

/* ===============================
   ç›¸æ€§è¨ºæ–­ï¼ˆå®Œå…¨ç‰ˆï¼‰
================================ */
function getCompatibility(a,b){
  if(!ATTR[a]||!ATTR[b]) return "å±æ€§ãƒ‡ãƒ¼ã‚¿ä¸è¶³";

  const attrA=ATTR[a].attribute;
  const attrB=ATTR[b].attribute;

  const pair=COMPAT.attribute_pair?.[attrA]?.[attrB];
  if(!pair) return "ç›¸æ€§æœªå®šç¾©";

  return `ç›¸æ€§ãƒ¬ãƒ™ãƒ«${pair.level}ï¼š${pair.comment}`;
}

document.getElementById("btn_pair").onclick=()=>{
  const a=Number(pair_a.value);
  const b=Number(pair_b.value);
  if(!a||!b){alert("å…¥åŠ›ä¸è¶³");return;}

  document.getElementById("pair_result").innerHTML=`
  <div class="card">
    <h3>å‘½æ•° ${a} Ã— ${b}</h3>
    <p>${getCompatibility(a,b)}</p>
  </div>`;
};
</script>

</body>
</html>
