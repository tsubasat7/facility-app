<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é‹å‘½ã®å…­å±æ€§è¨ºæ–­ï¼ˆå†…éƒ¨ãƒ„ãƒ¼ãƒ«ï¼‰</title>
<style>
body{font-family:sans-serif;background:#fff;margin:0}
header{padding:16px;border-bottom:1px solid #eee}
.container{max-width:900px;margin:auto;padding:24px}
.card{border:1px solid #ddd;border-radius:16px;padding:16px;margin-bottom:16px}
button{padding:10px 16px;border-radius:20px;border:1px solid #aaa}
.run{background:#222;color:#fff;border:none}
small{color:#666}
</style>
</head>
<body>

<header>
<h2>ğŸ”® é‹å‘½ã®å…­å±æ€§è¨ºæ–­</h2>
<small>å†…éƒ¨ç”¨</small>
</header>

<div class="container">

<div class="card">
<label>åå‰</label>
<input id="name" style="width:100%"><br><br>

<label>ç”Ÿå¹´æœˆæ—¥</label>
<input id="birth" type="date" style="width:100%"><br><br>

<button class="run" onclick="analyze()">è¨ºæ–­ã™ã‚‹</button>
</div>

<div id="result"></div>

</div>

<script>
function calcMeisuu(date){
  let sum=date.replace(/-/g,"").split("").map(Number).reduce((a,b)=>a+b,0);
  while(sum>60){
    sum=sum.toString().split("").reduce((a,b)=>a+Number(b),0);
  }
  return sum||60;
}

async function safeFetch(path){
  const r = await fetch(path);
  if(!r.ok) throw new Error(path+" ãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“");
  return r.json();
}

async function analyze(){
  alert("è¨ºæ–­é–‹å§‹ï¼ˆãƒœã‚¿ãƒ³ã¯åå¿œã—ã¦ã„ã¾ã™ï¼‰");

  const name=document.getElementById("name").value||"æœªå…¥åŠ›";
  const birth=document.getElementById("birth").value;
  if(!birth){ alert("ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }

  try{
    const meisuu=calcMeisuu(birth);

    const traits = await safeFetch("data/flattype_traits.json");
    const story  = await safeFetch("data/story.json");

    const t = traits[meisuu];
    const s = story[meisuu];

    document.getElementById("result").innerHTML=`
      <div class="card">
        <h3>${name} ã•ã‚“</h3>
        <p>å‘½æ•°ï¼š${meisuu}</p>
        <h4>æ€§æ ¼</h4><p>${t.core}</p>
        <h4>éå»</h4><p>${s.past}</p>
      </div>
    `;
  }catch(e){
    document.getElementById("result").innerHTML=
      "<div class='card'><b>ã‚¨ãƒ©ãƒ¼:</b><br>"+e.message+"</div>";
  }
}
</script>

</body>
</html>
